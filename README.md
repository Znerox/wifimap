# WifiMap
Makes data generated by wigle android app searchable (with filters) and overlays it on google maps.

###About

I wanted to see the networks in my neighbourhood, but found the global map on wigle.net to be far from detailed enough. With this you can take the data generated by the wigle app, and overlay it on google maps. You also get filtering options based on encryption, SSID, BSSID, date seen and more.
It is also possible to import data generated by airodump-ng on linux, connect it with the data from wigle, and potentially see which clients that have probed or been connected to networks in your database.


###Requirements

web server
mysql
php


I have tested this on Debian 7/8, with php 5.6.

The following packages are required for full functionality:
php5 (or higher, untested)
mysql-server
php5-mysql (or higher, untested)
php5-curl (or higher, untested)

###Setting up server/installing

#####File structure and permissions:
Place the "wifimap" folder on your webserver, and make it available for the users of the map (e.g. make it public if you want public access to the map).
Place the "tools" folder on your webserver, and set up webserver permissions so only those who will upload data to the database can access it.
The "tools" folder include various tools that are used to import data and update the database as needed.
Once  that is done, make sure "../tools/php/uploads" have permission "777" (full access for every user on the system). That is necessary for importing data. Note that currently all files uploaded (imported) are being stored forever, or until overwritten by another file with the same name.


#####Database:
If you are using phpmyadmin you can run everything in "dbsetup" to create the database.
You might have to log out and log in again to see the new database.
It's recommended to create a new user with only access to the "wifimap" database info.
There are a total number of four files named "dbinfo.php" where you need to enter the credentials for the mysql user.
They are located in:
1. ../tools/php/
2. ../wifimap/php
3. ../wifimap/location/php
4. ../wifimap/clients/php


To support uploading big files, and running scripts for a long period of time, change these settings in php.ini
Example from Debian with Apache web server

in the file:
/etc/php5/apache2/php.ini

Find these lines:
```
; Maximum allowed size for uploaded files.
; http://php.net/upload-max-filesize
upload_max_filesize = 2M
```

Change to:
upload_max_filesize = 100M


Find these lines:
```
; Maximum size of POST data that PHP will accept.
; Its value may be 0 to disable the limit. It is ignored if POST data reading
; is disabled through enable_post_data_reading.
; http://php.net/post-max-size
post_max_size = 8M
```

Change to:
post_max_size = 100M


Find these lines:
```
; Maximum execution time of each script, in seconds
; http://php.net/max-execution-time
; Note: This directive is hardcoded to 0 for the CLI SAPI
max_execution_time = 30
```

Change to:
max_execution_time = -1


Find these lines:
```
; Maximum amount of time each script may spend parsing request data. It's a good
; idea to limit this time on productions servers in order to eliminate unexpectedly
; long running scripts.
; Note: This directive is hardcoded to -1 for the CLI SAPI
; Default Value: -1 (Unlimited)
; Development Value: 60 (60 seconds)
; Production Value: 60 (60 seconds)
; http://php.net/max-input-time
max_input_time = 60
```

Change to:
max_input_time = -1


Find these lines:
```
; After this number of seconds, stored data will be seen as 'garbage' and
; cleaned up by the garbage collection process.
; http://php.net/session.gc-maxlifetime
session.gc_maxlifetime = 1440
```

Change to:
session.gc_maxlifetime = 21600



Once that is done, you should be ready to import data from wigle.
One option is to run "backup database" in the wigle app, which will backup the entire local db from the device to a file called "backup-xxxxxxxxxxxxx.sqlite".
Move that over to your pc (you might have to move it to another folder on the phone to be able to access it over usb from pc). Open the .sqlite file and export each table to a seperate .csv file. On windows "DB Browser for SQLite" (https://github.com/sqlitebrowser/sqlitebrowser) is a great tool.
In "DB Browser for SQLite", choose "File, Export, Table(s) as CSV file". Select "location" and "network". You can keep "Column names in the first line" checked, keep "Field separator" at the default ",", and keep "Quote character" at the default ". Under "New line characters", select "Unix: LF (\n)".
Once you have a "network.csv" and a "location.csv" file, those can be imported with the "Upload network file" and "Upload location file" options on the "tools" page.


In "wifimap/js/settings.js" there are several settings that can be changed. Thoose include language (English is default, Norwegian partially supported). The center off the map, and the IP address/URL to the site. Those NEED to be set for everything to work correctly. You should also change the "bestLat" and "bestLon" variables in "wifimap/location/js/index.js". They should be the same as "mapCenterLatitude" and "mapCenterLongitude" in "settings.js"


###Tools explained

First of all, when uploading files I recommend always keeping the original files. There are some bugs at the moment which leads to a small percentage of uploaded data having wrong ssid, or other incorrect data. Some of these networks containing incorrect information are automatically being deleted by the "Update fields in network table" script. In case of future bug fixes, you might need to empty/drop the database, and upload the files again.

#####Upload network file

This takes the "network.csv" file, and passes it to a php script which will go through it and import/update data to the mysql database.
Always run "Update fields in network table" after this.

#####Upload old network file

For files exported from older versions of wigle. If you're not sure which one to use, open your network.csv/location.csv in a text editor. If the first character in the file is a quotation mark ("), you've got yourself an "old" file.

#####Upload location file

This takes the "location.csv" file, and passes it to a php script which will go through it and import/update data to the mysql database.
Always run "Update fields in location table" after this.

#####Upload old location file

For files exported from older versions of wigle. If you're not sure which one to use, open your network.csv/location.csv in a text editor. If the first character in the file is a quotation mark ("), you've got yourself an "old" file.

#####Upload client file

This takes the "*.csv" files generated by airodump-ng, and puts any information about clients in the "clients" table.
This is only for files generated by aircrack-ng version 1.2-rc2 and newer (newer versions untested, but should work).

#####Upload old client file

Same as the previous, except this is for files generated by aircrack-ng version 1.2-rc1 and earlier (earlier versions untested, but any fairly recent version should work)

#####Update fields in network table

This sets some additional fields in the database, which do not exist in the file generated by wigle. For example channel, band, and URL for the icon showing up on the map. This is added to the database to avoid having additional code run each time the site is loaded, slowing it down.

#####Update fields in location table

Same as previos, except for location table.

#####Update connected clients in network table

This looks up each client in the "clients" table, and checks if that client has been connected any router/AP (based on MAC address) currently in the network table. This can take a very long time, as each client is checked against every router/AP in the network table.

#####Update probing clients in network table

This looks up each client in the "clients" table, and checks if that client has been probing for an SSID that matches that of any router/AP currently in the network table. This can take an even longer time, as each client's probe is checked against every router/AP in the network table.

#####Lookup MAC address for routers

This takes the OUI (piece of MAC address identifying vendor) on all networks, and looks it up against macvendors.com
Currently it goes through 500 different OUI's before stopping and printing out some stats. If you want it to run until completed, comment out line 97 in "network_mac_lookup.php"

#####Lookup MAC address for clients

Same as previous, except for clients. If you want it to run until completed, comment out line 97 in "clients_mac_lookup.php"
